<div *ngIf="slicing">
  <div class="row">
    <div class="col-6">
      <h4>Source Slicing</h4>
      <div>
        Slicing type:
        <div class="badge">
          {{ slicing.type }}
        </div>
      </div>
    </div>
    <div class="col-6">
      <h4>Derived Slicing</h4>
      <div>
        Slicing type:
        <div class="badge">
          {{ slicing.type }}
        </div>
      </div>
    </div>
  </div>
  <div class="row" *ngIf="slicing.slice">
    <div class="col-6">
      <div>
        <table
          class="table table-striped table-sm table-bordered"
          style="text-align: center; margin-bottom: 0"
        >
          <tr>
            <th>
              <ng-container *ngIf="slicing.type === 'OCCURRENCE'">
                Occurrence
              </ng-container>
              <ng-container *ngIf="slicing.type === 'ASSERTION'">
                Condition
              </ng-container>
            </th>
            <th>Flavor</th>
            <th>Comments</th>
          </tr>
          <ng-container *ngFor="let slice of slicing.slice">
            <tr
              *ngIf="
                slice.data.flavor.src.value ||
                slice.data.flavor.src.value === ''
              "
            >
              <td>
                <ng-container *ngIf="slicing.type === 'OCCURRENCE'">
                  {{ slice.data.occurence.src.value }}
                </ng-container>
                <ng-container *ngIf="slicing.type === 'ASSERTION'">
                  {{ slice.data.assertion.src.value }}
                </ng-container>
              </td>
              <td>
                {{ slice.data.flavor.src.value }}
              </td>
              <td>
                {{ slice.data.comment.src.value }}
              </td>
            </tr>
          </ng-container>
        </table>
      </div>

      <!-- <div>
        <ng-container *ngIf="selectedSrc.codes.length === 0">
          <div>No codes</div>
        </ng-container>
        <table
          *ngIf="selectedSrc.codes.length > 0"
          class="table table-striped table-sm table-bordered"
          style="text-align: center; margin-bottom: 0"
        >
          <tr>
            <th>Value</th>
            <th>Description</th>
            <th>Code System</th>
            <th>Usage</th>
            <th>Comments</th>
          </tr>
          <tr *ngFor="let item of selectedSrc.codes">
            <td>{{ item.value }}</td>
            <td>{{ item.description }}</td>
            <td>{{ item.codeSystem }}</td>
            <td>{{ item.usage }}</td>
            <td>{{ item.comment }}</td>
          </tr>
        </table>
      </div> -->
    </div>
    <div class="col-6">
      <table
        class="table table-striped table-sm table-bordered"
        style="text-align: center; margin-bottom: 0"
      >
        <tr>
          <th>
            <ng-container *ngIf="slicing.type === 'OCCURRENCE'">
              Occurrence
            </ng-container>
            <ng-container *ngIf="slicing.type === 'ASSERTION'">
              Condition
            </ng-container>
          </th>
          <th>Flavor</th>
          <th>Comments</th>
        </tr>
        <ng-container *ngFor="let slice of slicing.slice">
          <!-- <tr *ngIf="slice.data.flavor.derived[ig] && slice.data.flavor.derived[ig].value"> -->
          <tr>
            <ng-container *ngIf="slicing.type === 'OCCURRENCE'">
              <td
                [ngClass]="{
                  deleted:
                    slice.data.occurence.derived[ig] &&
                    slice.data.occurence.derived[ig].status === 'deleted',
                  added:
                    slice.data.occurence.derived[ig] &&
                    slice.data.occurence.derived[ig].status === 'added',
                  changed:
                    slice.data.occurence.derived[ig] &&
                    slice.data.occurence.derived[ig].status === 'changed'
                }"
              >
                <ng-container *ngIf="slice.data.occurence.derived[ig]">
                  {{ slice.data.occurence.derived[ig].value }}
                </ng-container>
                <ng-container *ngIf="!slice.data.occurence.derived[ig]">
                  {{ slice.data.occurence.src.value }}
                </ng-container>
              </td>
            </ng-container>
            <ng-container *ngIf="slicing.type === 'ASSERTION'">
              <td
                [ngClass]="{
                  deleted:
                    slice.data.assertion.derived[ig] &&
                    slice.data.assertion.derived[ig].status === 'deleted',
                  added:
                    slice.data.assertion.derived[ig] &&
                    slice.data.assertion.derived[ig].status === 'added',
                  changed:
                    slice.data.assertion.derived[ig] &&
                    slice.data.assertion.derived[ig].status === 'changed'
                }"
              >
                <ng-container *ngIf="slice.data.assertion.derived[ig]">
                  {{ slice.data.assertion.derived[ig].value }}
                </ng-container>
                <ng-container *ngIf="!slice.data.assertion.derived[ig]">
                  {{ slice.data.assertion.src.value }}
                </ng-container>
              </td>
            </ng-container>

            <td
              [ngClass]="{
                deleted:
                  slice.data.flavor.derived[ig] &&
                  slice.data.flavor.derived[ig].status === 'deleted',
                added:
                  slice.data.flavor.derived[ig] &&
                  slice.data.flavor.derived[ig].status === 'added',
                changed:
                  slice.data.flavor.derived[ig] &&
                  slice.data.flavor.derived[ig].status === 'changed'
              }"
            >
              <ng-container *ngIf="slice.data.flavor.derived[ig]">
                {{ slice.data.flavor.derived[ig].value }}
              </ng-container>
              <ng-container *ngIf="!slice.data.flavor.derived[ig]">
                {{ slice.data.flavor.src.value }}
              </ng-container>
            </td>
            <td
              [ngClass]="{
                deleted:
                  slice.data.comment.derived[ig] &&
                  slice.data.comment.derived[ig].status === 'deleted',
                added:
                  slice.data.comment.derived[ig] &&
                  slice.data.comment.derived[ig].status === 'added',
                changed:
                  slice.data.comment.derived[ig] &&
                  slice.data.comment.derived[ig].status === 'changed'
              }"
            >
              <ng-container *ngIf="slice.data.comment.derived[ig]">
                {{ slice.data.comment.derived[ig].value }}
              </ng-container>
              <ng-container *ngIf="!slice.data.comment.derived[ig]">
                {{ slice.data.comment.src.value }}
              </ng-container>
            </td>
          </tr>
        </ng-container>
      </table>
      <!-- <div>
        <p-dropdown
          [options]="derivedValuesets"
          [(ngModel)]="selectedDerived"
          optionLabel="bindingIdentifier"
          optionValue="bindingIdentifier"
          (ngModelChange)="derivedChanged($event)"
          placeholder="Value set"
          appendTo="body"
        ></p-dropdown>
      </div>
      <div *ngIf="selectedDerived">
        <ng-container *ngIf="comparedCodes.length === 0">
          <div>No codes</div>
        </ng-container>
        <table
          *ngIf="comparedCodes.length > 0"
          class="table table-striped table-sm table-bordered"
          style="text-align: center; margin-bottom: 0"
        >
          <tr>
            <th>Value</th>
            <th>Description</th>
            <th>Code System</th>
            <th>Usage</th>
            <th>Comments</th>
          </tr>
          <tr
            *ngFor="let item of comparedCodes; index as i"
            [ngClass]="{
              deleted: item.status === 'deleted',
              added: item.status === 'added'
            }"
          >
            <td>
              {{ item.value }}
            </td>
            <td
              [ngClass]="{
                changed: item.description?.status === 'changed'
              }"
            >
              {{ item.description }}
            </td>
            <td>
              {{ item.codeSystem }}
            </td>
            <td
              [ngClass]="{
                changed: item.usage?.status === 'changed'
              }"
            >
              <ng-container *ngIf="item.usage?.value">
                {{ item.usage.value }}
              </ng-container>
              <ng-container *ngIf="!item.usage?.value">
                {{ item.usage }}
              </ng-container>
            </td>
            <td
              [ngClass]="{
                changed: item.comment?.status === 'changed'
              }"
            >
              {{ item.comment }}
            </td>
          </tr>
        </table>
      </div> -->
    </div>
  </div>
</div>
